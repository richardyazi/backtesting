# è‚¡ç¥¨æ•°æ®ç¼“å­˜è„šæœ¬

ä¸€ä¸ªæ™ºèƒ½çš„è‚¡ç¥¨æ•°æ®ç¼“å­˜è„šæœ¬ï¼Œä¸“ä¸ºèšå®½Jupyter Notebookç¯å¢ƒè®¾è®¡ã€‚é€šè¿‡ä¼˜åŒ–APIè°ƒç”¨å’Œæœ¬åœ°ç¼“å­˜ç®¡ç†ï¼Œå®ç°é«˜æ•ˆçš„æ•°æ®è·å–å’Œå­˜å‚¨ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **æ™ºèƒ½ç¼“å­˜ç®¡ç†**ï¼šè‡ªåŠ¨æ£€æµ‹ç¼“å­˜çŠ¶æ€ï¼Œæ”¯æŒå¢é‡/å…¨é‡ä¸‹è½½æ¨¡å¼
- ğŸ“Š **èšå®½APIé›†æˆ**ï¼šç›´æ¥è°ƒç”¨èšå®½é«˜è´¨é‡å†å²æ•°æ®
- ğŸ¯ **æ¿å—åˆ†ç±»ç®¡ç†**ï¼šæ”¯æŒæŒ‰æ¿å—åˆ†ç±»ç®¡ç†è‚¡ç¥¨æ± 
- ğŸ’¾ **é«˜æ•ˆå­˜å‚¨**ï¼šä½¿ç”¨Parquetæ ¼å¼ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´
- âš¡ **æ‰¹é‡å¤„ç†**ï¼šæ”¯æŒå¤šè‚¡ç¥¨æ‰¹é‡ä¸‹è½½å’Œå¤„ç†
- ğŸ”§ **çµæ´»é…ç½®**ï¼šæ”¯æŒè‡ªå®šä¹‰è‚¡ç¥¨æ± å’Œå‚æ•°é…ç½®
- ğŸ“ˆ **ç ”ç©¶å‹å¥½**ï¼šä¸“ä¸ºé‡åŒ–ç ”ç©¶è®¾è®¡çš„æ¥å£

## é¡¹ç›®ç»“æ„

```
å›æµ‹/
â”œâ”€â”€ config.py                 # é…ç½®æ–‡ä»¶
â”œâ”€â”€ stock_cache.py            # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ example_usage.ipynb       # ä½¿ç”¨ç¤ºä¾‹
â”œâ”€â”€ README.md                 # è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ utils/                    # å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ stock_utils.py        # è‚¡ç¥¨å·¥å…·å‡½æ•°
â”œâ”€â”€ cache/                    # ç¼“å­˜ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ cache_manager.py      # ç¼“å­˜ç®¡ç†å™¨
â”œâ”€â”€ data_fetcher/             # æ•°æ®è·å–æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ jq_fetcher.py         # èšå®½æ•°æ®è·å–å™¨
â””â”€â”€ storage/                  # å­˜å‚¨ç®¡ç†æ¨¡å—
    â”œâ”€â”€ __init__.py
    â””â”€â”€ storage_manager.py    # å­˜å‚¨ç®¡ç†å™¨
```

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

ç¡®ä¿åœ¨èšå®½ç¯å¢ƒä¸­è¿è¡Œï¼Œéœ€è¦ä»¥ä¸‹ä¾èµ–ï¼š

```bash
# èšå®½ç¯å¢ƒå·²åŒ…å«ä»¥ä¸‹åº“
# pandas, numpy, pyarrow (ç”¨äºParquetæ ¼å¼)
```

### 2. åŸºæœ¬ä½¿ç”¨

```python
# å¯¼å…¥æ¨¡å—
from stock_cache import StockCache

# åˆ›å»ºç¼“å­˜å™¨
cache = StockCache()

# ä¸‹è½½æ‰€æœ‰è‚¡ç¥¨æ•°æ®
cache.download_all_stocks()

# è·å–å•åªè‚¡ç¥¨æ•°æ®
data = cache.get_stock_data('601888.XSHG')

# æ•°æ®åˆ†æ
print(data.head())
print(data.describe())
```

### 3. è‡ªå®šä¹‰é…ç½®

```python
# è‡ªå®šä¹‰é…ç½®
custom_config = {
    'pool_stocks': {
        'ç§‘æŠ€è‚¡': ['000977', '300750', '688981'],
        'é‡‘èè‚¡': ['601318', '600036', '000001']
    },
    'jq_params': {
        'start_date': '2023-01-01',
        'end_date': '2024-12-31',
        'frequency': 'daily'
    }
}

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
cache = StockCache(custom_config)
```

## è¯¦ç»†ä½¿ç”¨è¯´æ˜

### è‚¡ç¥¨ä»£ç æ ¼å¼

è„šæœ¬æ”¯æŒä¸¤ç§è‚¡ç¥¨ä»£ç æ ¼å¼ï¼š
- **æ™®é€šæ ¼å¼**: `601888`, `002594` (è‡ªåŠ¨è½¬æ¢ä¸ºèšå®½æ ¼å¼)
- **èšå®½æ ¼å¼**: `601888.XSHG`, `002594.XSHE`

### ä¸‹è½½æ¨¡å¼

- **å…¨é‡ä¸‹è½½**: ä¸‹è½½å®Œæ•´æ—¶é—´èŒƒå›´çš„æ•°æ®
- **å¢é‡ä¸‹è½½**: åªä¸‹è½½ç¼“å­˜ä¹‹åçš„æ–°æ•°æ®
- **æ— éœ€ä¸‹è½½**: æ•°æ®å·²æœ€æ–°ï¼Œè·³è¿‡ä¸‹è½½

### æ•°æ®å­˜å‚¨

æ•°æ®æŒ‰ä»¥ä¸‹ç»“æ„å­˜å‚¨ï¼š
```
data/
â”œâ”€â”€ 2001/          # æŒ‰ä¸Šå¸‚å¹´ä»½åˆ†ç›®å½•
â”‚   â””â”€â”€ 600519_XSHG.parquet
â”œâ”€â”€ 2004/
â”‚   â””â”€â”€ 601888_XSHG.parquet
â””â”€â”€ cache_meta.json  # ç¼“å­˜å…ƒæ•°æ®
```

## é…ç½®è¯´æ˜

### è‚¡ç¥¨æ± é…ç½® (`pool_stocks`)

```python
pool_stocks = {
    'æ ¸å¿ƒè‚¡': ['601888', '002594'],
    'ç‰¹é«˜å‹': ['601179', '600406', '600312']
}
```

### èšå®½APIå‚æ•° (`jq_params`)

```python
jq_params = {
    'start_date': '2010-01-01',      # å¼€å§‹æ—¥æœŸ
    'end_date': '2025-12-04',        # ç»“æŸæ—¥æœŸ
    'frequency': 'daily',            # æ•°æ®é¢‘ç‡: daily/weekly/monthly/minute
    'fields': ['open', 'high', 'low', 'close', 'volume'],  # æ•°æ®å­—æ®µ
    'fq': 'pre',                     # å¤æƒæ–¹å¼: pre/post/None
    'skip_paused': False,            # æ˜¯å¦è·³è¿‡åœç‰Œ
    'fill_paused': True,             # æ˜¯å¦å¡«å……åœç‰Œæ•°æ®
    'panel': False                   # è¿”å›æ ¼å¼
}
```

### ç¼“å­˜é…ç½® (`cache_config`)

```python
cache_config = {
    'update_strategy': 'incremental',  # æ›´æ–°ç­–ç•¥: incremental/full
    'auto_update': True,               # è‡ªåŠ¨æ›´æ–°
    'check_interval': 'daily',         # æ£€æŸ¥é—´éš”
    'max_retry': 3,                    # æœ€å¤§é‡è¯•æ¬¡æ•°
    'retry_delay': 5                   # é‡è¯•å»¶è¿Ÿ(ç§’)
}
```

### å­˜å‚¨é…ç½® (`storage_config`)

```python
storage_config = {
    'base_path': './data',             # å­˜å‚¨è·¯å¾„
    'format': 'parquet',               # å­˜å‚¨æ ¼å¼: parquet/csv
    'compression': 'snappy',           # å‹ç¼©æ–¹å¼
    'by_listing_year': True            # æŒ‰ä¸Šå¸‚å¹´ä»½åˆ†ç›®å½•
}
```

## APIå‚è€ƒ

### StockCacheç±»

#### ä¸»è¦æ–¹æ³•

- `__init__(custom_config=None)`: åˆå§‹åŒ–ç¼“å­˜å™¨
- `download_all_stocks(force_full=False)`: ä¸‹è½½æ‰€æœ‰è‚¡ç¥¨æ•°æ®
- `download_single_stock(stock_code, force_full=False)`: ä¸‹è½½å•åªè‚¡ç¥¨æ•°æ®
- `get_stock_data(stock_code)`: è·å–è‚¡ç¥¨æ•°æ®
- `update_cache(categories=None)`: æ›´æ–°ç¼“å­˜
- `list_categories()`: è·å–æ‰€æœ‰åˆ†ç±»
- `get_stocks_by_category(category)`: è·å–åˆ†ç±»è‚¡ç¥¨åˆ—è¡¨

### å·¥å…·å‡½æ•°

- `convert_to_jq_code(stock_code)`: è½¬æ¢ä¸ºèšå®½æ ¼å¼
- `convert_stock_pool(pool_stocks)`: è½¬æ¢è‚¡ç¥¨æ± 
- `get_all_stocks_from_pool(pool_stocks)`: è·å–æ‰€æœ‰è‚¡ç¥¨
- `validate_stock_code(stock_code)`: éªŒè¯è‚¡ç¥¨ä»£ç 

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•æ·»åŠ æ–°çš„è‚¡ç¥¨ï¼Ÿ
A: åœ¨é…ç½®æ–‡ä»¶çš„ `pool_stocks` ä¸­æ·»åŠ æ–°çš„åˆ†ç±»å’Œè‚¡ç¥¨ä»£ç ã€‚

### Q: æ•°æ®å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ
A: é»˜è®¤å­˜å‚¨åœ¨ `./data` ç›®å½•ï¼Œå¯åœ¨é…ç½®ä¸­ä¿®æ”¹ `base_path`ã€‚

### Q: å¦‚ä½•æ›´æ–°åˆ°æœ€æ–°æ•°æ®ï¼Ÿ
A: è¿è¡Œ `cache.update_cache()` æˆ– `cache.download_all_stocks()`ã€‚

### Q: æ”¯æŒå“ªäº›æ•°æ®é¢‘ç‡ï¼Ÿ
A: æ”¯æŒ daily, weekly, monthly, minute ç­‰èšå®½æ”¯æŒçš„æ‰€æœ‰é¢‘ç‡ã€‚

### Q: å¦‚ä½•å¤„ç†APIè°ƒç”¨é™åˆ¶ï¼Ÿ
A: è„šæœ¬å†…ç½®äº†é‡è¯•æœºåˆ¶å’Œå»¶è¿Ÿç­–ç•¥ï¼Œä¼šè‡ªåŠ¨å¤„ç†APIé™åˆ¶ã€‚

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **åˆ†æ‰¹å¤„ç†**: å¤§é‡è‚¡ç¥¨æ—¶ä½¿ç”¨åˆ†æ‰¹å¤„ç†
2. **åˆç†è®¾ç½®æ—¶é—´èŒƒå›´**: é¿å…ä¸‹è½½ä¸å¿…è¦çš„å†å²æ•°æ®
3. **ä½¿ç”¨Parquetæ ¼å¼**: æ¯”CSVæ ¼å¼æ›´èŠ‚çœç©ºé—´
4. **å®šæœŸæ¸…ç†ç¼“å­˜**: åˆ é™¤ä¸å†éœ€è¦çš„è‚¡ç¥¨æ•°æ®

## ç‰ˆæœ¬å†å²

- v1.0.0: åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒåŸºæœ¬ç¼“å­˜åŠŸèƒ½
- æ”¯æŒèšå®½APIé›†æˆã€æ™ºèƒ½ç¼“å­˜ç®¡ç†ã€æ‰¹é‡å¤„ç†

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ã€‚

## è®¸å¯è¯

MIT License